<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dynamic Time Portal</title>
  <style>
    /* Basic centered card layout */
    body { font-family: Arial, sans-serif; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#f5f7fb; }
    .card { background:white; padding:2rem 3rem; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.08); text-align:center; }
    .time { font-size:2rem; font-weight:600; }
    .date { color:#666; margin-top:0.5rem; }
    button { margin-top:1rem; padding:0.5rem 1rem; }
  </style>
</head>
<body>
  <!--
    Simple UI elements:
    - #time: displays current time (updated every second)
    - #date: displays the date
    - #logBtn: optional button to write a visit into Oracle DB
    - #status: small status area for messages
  -->
  <div class="card">
    <div class="time" id="time">--:--:--</div>
    <div class="date" id="date">Loading...</div>
    <button id="logBtn">Log visit to Oracle DB</button>
    <div id="status" style="margin-top:.75rem;color:#333"></div>
  </div>

  <script>
    // Fetch the server time (JSON) and update the UI.
    // The server returns UTC in ISO format; the browser converts
    // and displays it according to the user's locale.
    async function fetchTime() {
      try {
        const res = await fetch('/time');
        const data = await res.json();
        // Parse the ISO timestamp into a JS Date object
        const d = new Date(data.server_time);
        document.getElementById('time').textContent = d.toLocaleTimeString();
        document.getElementById('date').textContent = d.toLocaleDateString();
      } catch (e) {
        // Show a non-intrusive error in the status area for beginners
        document.getElementById('status').textContent = 'Error fetching time';
      }
    }

    // Start immediately and refresh every second to show running seconds.
    fetchTime();
    setInterval(fetchTime, 1000);

    // When the log button is clicked, POST to /log_visit which will
    // attempt to insert a row into the Oracle `visits` table.
    document.getElementById('logBtn').addEventListener('click', async () => {
      document.getElementById('status').textContent = 'Logging...';
      try {
        const res = await fetch('/log_visit', { method: 'POST' });
        const data = await res.json();
        if (res.ok) document.getElementById('status').textContent = 'Logged to DB';
        else document.getElementById('status').textContent = 'DB unavailable';
      } catch (e) {
        document.getElementById('status').textContent = 'Error logging visit';
      }
    });
  </script>
</body>
</html>