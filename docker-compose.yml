version: '3.8'

# Compose file for local development. It starts two services:
# - app: the Flask application built from the local Dockerfile
# - oracle: an example Oracle XE database (optional)
services:
  app:
    build: .
    ports:
      - "5000:5000"
    environment:
      # These env vars allow the app to connect to Oracle when present
      - ORACLE_USER=appuser
      - ORACLE_PASSWORD=changeit
      - ORACLE_DSN=oracle:1521/XE
    depends_on:
      - oracle

  oracle:
    # Lightweight Oracle XE image for local testing; consult the
    # image docs for production use and persistent storage.
    image: gvenzl/oracle-xe:18-slim
    environment:
      - ORACLE_PASSWORD=changeit
    ports:
      - "1521:1521"
    healthcheck:
      # Simple healthcheck that attempts to run a no-op SQL command.
      test: ["CMD-SHELL", "/bin/bash -c 'echo exit | sqlplus -s sys/${ORACLE_PASSWORD}@//localhost:1521/XE as sysdba | grep -q "" || exit 1'" ]
      interval: 10s
      retries: 30
